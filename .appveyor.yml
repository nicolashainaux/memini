version: build{build}

branches:
  only:
  - master
  - pre-release

max_jobs: 1

# For Python versions available on Appveyor, see
# https://www.appveyor.com/docs/windows-images-software/#python
# https://www.appveyor.com/docs/linux-images-software#python
environment:
  matrix:
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2015
      PYVER: "C:\\Python36-x64"
      PYVER: "C:\\Python37-x64"
      PYVER: "C:\\Python38-x64"
    - APPVEYOR_BUILD_WORKER_IMAGE: Ubuntu2004
  global:
    PYTHON: '%PYVER%\python.exe'

install:
  # We need wheel installed to build wheels
  - cmd: "curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | %PYTHON%"
  - cmd: "set PATH=%USERPROFILE%\\.poetry\\bin;%PATH%"
  - cmd: "poetry install"
  - sh: "sudo apt-get -y update"
  - sh: "sudo apt-get install -y python3-venv"
  - sh: "curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py > ../get-poetry.py"
  - sh: "python3 ../get-poetry.py --yes"
  - sh: "source $HOME/.poetry/env"
  - sh: "poetry env use 3.8"
  - sh: "poetry install"
  - sh: "sudo ln -s $HOME/venv3.7/bin/python3.7 /usr/local/bin/python3.7"
  - sh: "poetry env use 3.7"
  - sh: "poetry install"

build: off

test_script:
  # Note that you must use the environment variable %PYTHON% to refer to
  # the interpreter you're using - Appveyor does not do anything special
  # to put the Python version you want to use on PATH.
  - cmd: "poetry run pytest -x -vv"
  - sh: "poetry run pytest -x -vv"
  - sh: "poetry env use 3.8"
  - sh: "poetry run pytest -x -vv"

# after_test:
#   # This step builds your wheels.
#   - cmd: "%PYTHON%\\python.exe setup.py bdist_wheel"
#   - sh: "codecov"

# artifacts:
#   # bdist_wheel puts your built wheel in the dist directory
#   - path: dist\*

#on_success:
#  You can use this step to upload your artifacts to a public website.
#  See Appveyor's documentation for more details. Or you can simply
#  access your wheels from the Appveyor "artifacts" tab for your build.

notifications:
- provider: Email
  to:
  - nh.techn@gmail.com
  on_build_success: false
  on_build_failure: false
  on_build_status_changed: true
